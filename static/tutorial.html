<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</head>
<body>
    <img src="logo.png" alt="logo" width="80" height="80">
    <h1>Insert video here</h1>

    <a href="topicsPage.html" class="continue-link">Let's start studying!</a>
    <button id="new">New Video</button>

    <iframe id="videoFrame" width="320" height="240" frameborder="0" allowfullscreen></iframe>

    <!-- Thumbs up and thumbs down buttons -->
    <button id="thumbsUpButton" onclick="thumbsUp()">Thumbs Up</button>
    <button id="thumbsDownButton" onclick="thumbsDown()">Thumbs Down</button>

    <script>
        const newButton = document.getElementById("new");
        const videoFrame = document.getElementById("videoFrame");

        function select() {
            $.post("/open_api/selectVideo", function (data) {
                console.log("success");
                videoFrame.src = data.embed_url;
            }, "json").fail(function (response) {
                console.log("error");
                console.log(response);
            });
        }

        newButton.addEventListener("click", function (event) {
            event.preventDefault(); // Prevent the default form submission behavior
            select();
        });

        function thumbsUp() {
            const videoID = 'your_video_id';  // Replace with the actual video ID
            $.post("/open_api/likeVideo", { video_id: videoID }, function (data) {
                console.log("Video liked successfully");

                // Get the user ID from the JWT payload
                const userID = getJWTUserId();
                updateRating(userID, videoID, 1);  // Set Rating to 1 for like
            }).fail(function (response) {
                console.log("Error liking video");
                console.log(response);
            });
        }

        function thumbsDown() {
            const videoID = 'your_video_id';  // Replace with the actual video ID
            $.post("/open_api/dislikeVideo", { video_id: videoID }, function (data) {
                console.log("Video disliked successfully");

                // Get the user ID from the JWT payload
                const userID = getJWTUserId();
                updateRating(userID, videoID, -1);  // Set Rating to -1 for dislike
            }).fail(function (response) {
                console.log("Error disliking video");
                console.log(response);
            });
        }

        function updateRating(userID, contentID, rating) {
            $.post("/open_api/updateRating", { user_id: userID, content_id: contentID, rating: rating }, function (data) {
                console.log("Rating updated successfully");
            }).fail(function (response) {
                console.log("Error updating rating");
                console.log(response);
            });
        }

        // Helper function to get the user ID from the JWT payload
        function getJWTUserId() {
            const token = 'your_jwt_token';  // Replace with the actual JWT token
            const decodedToken = parseJwt(token);
            return decodedToken.user_id;  // Assuming 'user_id' is the field in your JWT payload
        }

        // Function to parse a JWT token and extract its payload
        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        }

        // Assuming you have a video element with id="video"
        const video = document.getElementById("video");

        video.addEventListener("play", (event) => {
            play_start(); // executing this function
        });

        const showInputButton = document.getElementById("showInputButton");
        const inputContainer = document.getElementById("inputContainer");
        showInputButton.addEventListener("click", function () {
            inputContainer.style.display = "block";
        });

        video.addEventListener("ended", (event) => {
            // Handle video ended event
        });
    </script>
</body>
</html>
